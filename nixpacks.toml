[variables]
# Keep a sane PATH at runtime
PATH = "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"

[phases.setup]
# Install gallery-dl via Nix (avoid pip/PEP-668 issues).
# Also explicitly include Node so `npm` exists during build.
nixPkgs = ["nodejs_20", "python3", "gallery-dl"]

[phases.install]
cmds = [
  "npm install",
  "cd client && npm install",
  # gallery-dl is provided by nixPkgs above
]

[phases.build]
cmds = [
  "cd client && npm run build"
]
